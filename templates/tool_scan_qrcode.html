<template>
    <style>

     
    </style>

    <div id="reader"></div>
    <div id="qr-reader" style="width: 300px;"></div>

    <audio id="beep">
        <source src="../assets/sounds/beep.wav" type="audio/wav">
    </audio>

    <!-- 
    <input type="file" id="qr-input-file" accept="image/*">

        Or add captured if you only want to enable smartphone camera, PC browsers will ignore it.

    <input type="file" id="qr-input-file" accept="image/*" capture>

    -->
    



</template>
<script>

    const pageData = main_data.tool_scan_qrcode.data
    const pageFunc = main_data.tool_scan_qrcode.func
    const pageScreen = document.querySelector('#card-tool_scan_qrcode')

    const beep =  new Audio('assets/sounds/beep.wav')
    
    pageFunc.fillComanda = (id)=>{
        const params = new Object;
            params.field = 'id'
            params.signal = '='
            params.value = id
            params.dt_ini = '2000-01-01'
            params.dt_fin = '2100-12-31'
            params.aberta = 0
        const myPromisse = queryDB(params,'CXA-0');
        myPromisse.then((resolve)=>{
            const json = JSON.parse(resolve)
            if(json.length == 1){
                closeModal('caixa_view_comanda')
                openHTML('caixa_view_comanda.html','pop-up',`Comanda - ${json[0].id.padStart(8,0)} - ${json[0].nome.toUpperCase()}`,json[0])
            }else{
                alert('Comanda inv√°lida')
            }


console.log(json)            

            
        })
    }


    function onScanSuccess(decodedText, decodedResult) {
        beep.play()
        console.log(decodedText)
        pageFunc.fillComanda(decodedText)
        closeModal('tool_scan_qrcode')
        qr.clear()
    }

    const qr = new Html5QrcodeScanner("reader", {fps: 10, qrbox: 250})
    qr.render(onScanSuccess)





</script>