<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="scripts/prototype.js"></script>
    <title>teste</title>
    <style>

        .frm, .panel{
            display: flex;
            flex-direction: column;
            gap: 10px;
            padding: 10px;
            width: 100%;
            justify-content: center;
            align-items: center;
        }

        .frm div{
            display: flex;
            flex-direction: row;
            gap: 10px;
        }

        .frm div label{
            min-width: 100px;
        }

        button{
            padding: 10px;
            max-width: 310px;
        }

    </style>
</head>
<body>
    
    <div class="frm">
        <div>
            <label for="edt_dt_ini">Entrada</label>
            <input type="date" id="edt_dt_ini" value="2024-04-03">    
            <input type="time" id="edt_hr_ini" value="07:00">
        </div>
        <div>
            <label for="edt_dt_fin">Saída</label>
            <input type="date" id="edt_dt_fin" value="2024-04-03">    
            <input type="time" id="edt_hr_fin" value="17:00">    
        </div>
        <div>
            <label for="ckb_alm">Almoço</label>
            <input type="checkbox" id="ckb_alm" checked>
            <button id="btn_calc">Calcular</button>
        </div>
        
    </div>

    <div class="panel">

    </div>

</body>
<script>

    const dia = new Object
    const panel = document.querySelector('.panel')

    function count_hour(dt_ini, dt_fin, vac=0, almoco=1){

        const out = new Object
        
        function formatTime(tm){
            return(parseFloat((tm).toFixed(2)))
        }

        function adn_not(dt_ini, dt_fin){
            let adn = 0
            let point = new Date(dt_ini.getFullDateTime())

            while (point < dt_fin){

                if(point.getHours() < 6 || point.getHours() >= 22){
                    const next = new Date( (point.getHours() < 6 ? point.getFormatDate() : point.tomorrow()) +' 06:00:00')
                    adn += (next < dt_fin ? next : dt_fin) - point
                    point = next
                }else{
                    point = new Date(point.getFormatDate() +' 22:00:00')
                }
            }
            return formatTime(adn/3600000)
        }

        out.HN = (vac || [0,6].includes(dt_ini.getDay())) ? 0 : dt_ini.getDay()==5 ? 8 : 9
        out.HT = formatTime((dt_fin-dt_ini)/3600000) - almoco
        out.Faltas = out.HT > out.HN ? 0 : formatTime(out.HN - out.HT)
        out.Almoco = almoco
        const only_HE = new Date(dt_ini)
        only_HE.addHour(out.HN + almoco)
        out.HE_ADN = adn_not(only_HE,dt_fin)
        out.ADN = adn_not(dt_ini,dt_fin) - out.HE_ADN
        out.HE = out.HT > out.HN ? formatTime(out.HT - out.HN - out.HE_ADN) : 0

        return out
    }






    document.querySelector('#btn_calc').addEventListener('click',()=>{

        const dt_ini = new Date(document.querySelector('#edt_dt_ini').value +' '+document.querySelector('#edt_hr_ini').value)
        const dt_fin = new Date(document.querySelector('#edt_dt_fin').value +' '+document.querySelector('#edt_hr_fin').value)
        const almoco = document.querySelector('#ckb_alm').checked ? 1 : 0

/*

        const HN = [0,6].includes(dt_ini.getDay()) ? 0 : dt_ini.getDay()==5 ? 8 : 9
        const HT = formatTime((dt_fin-dt_ini)/3600000) -  almoco
        const Faltas = HT > HN ? 0 : formatTime(HN-HT)
        const only_HE = new Date(dt_ini)
        only_HE.addHour(HN+almoco)
        const HE_ADN = adn_not(only_HE,dt_fin)
        const HE = HT > HN ? formatTime(HT - HN - HE_ADN) : 0
        const ADN = adn_not(dt_ini,dt_fin) - HE_ADN
 */
        const he = count_hour(dt_ini, dt_fin, vac=0, alm=almoco)
//        console.log(he)

        panel.innerHTML = `Horas Trabalhadas : ${he.HT}<br>
                           Horas Normais : ${he.HN}<br>
                           Horas Extra : ${he.HE}<br>
                           Adiconal Noturno : ${he.ADN}<br>
                           H. Extra + Adn Not : ${he.HE_ADN}<br>
                           Faltas : ${he.Faltas}<br>`

    })

</script>
</html>